C51 COMPILER V9.60.7.0   MAIN                                                              12/03/2025 20:23:49 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg51.h>
   2          #include <intrins.h>
   3          
   4          sbit DIGIT_A = P2^2;   // A input of 74HC138
   5          sbit DIGIT_B = P2^3;   // B input of 74HC138
   6          sbit DIGIT_C = P2^4;   // C input of 74HC138
   7          
   8          
   9          void select_digit(unsigned char digit) {
  10   1        switch(digit) {
  11   2          case 0: DIGIT_A=0; DIGIT_B=0; DIGIT_C=0; break; // Y0
  12   2          case 1: DIGIT_A=1; DIGIT_B=0; DIGIT_C=0; break; // Y1
  13   2          case 2: DIGIT_A=0; DIGIT_B=1; DIGIT_C=0; break; // Y2
  14   2          case 3: DIGIT_A=1; DIGIT_B=1; DIGIT_C=0; break; // Y3
  15   2          case 4: DIGIT_A=0; DIGIT_B=0; DIGIT_C=1; break; // Y4 ? COM1
  16   2          case 5: DIGIT_A=1; DIGIT_B=0; DIGIT_C=1; break; // Y5 ? COM2
  17   2          case 6: DIGIT_A=0; DIGIT_B=1; DIGIT_C=1; break; // Y6 ? COM3
  18   2          case 7: DIGIT_A=1; DIGIT_B=1; DIGIT_C=1; break; // Y7 ? COM4
  19   2        }
  20   1      }
  21          
  22          
  23          unsigned char seg_code[] = {
  24            0x3F, // 0
  25            0x06, // 1
  26            0x5B, // 2
  27            0x4F, // 3
  28            0x66, // 4
  29            0x6D, // 5
  30            0x7D, // 6
  31            0x07, // 7
  32            0x7F, // 8
  33            0x6F  // 9
  34          };
  35          
  36          // DHT22 connections
  37          sbit DHT22_VCC = P2^7;   // Power pin
  38          sbit DHT22_GND = P2^5;   // Ground pin
  39          sbit DHT22_DATA = P2^1;  // Data pin
  40          
  41          void delay_us(unsigned int us) {
  42   1          while(us--) _nop_();  // Adjust for your clock frequency
  43   1      }
  44          
  45          void delay_ms(unsigned int ms) {
  46   1          unsigned int i, j;
  47   1          for(i=0; i<ms; i++)
  48   1              for(j=0; j<123; j++);   // Adjust for 12MHz clock
  49   1      }
  50          
  51          void display(unsigned char d1, unsigned char d2, unsigned char d3, unsigned char d4) {
  52   1        select_digit(2); P0 = seg_code[d1]; delay_ms(2);
  53   1        select_digit(1); P0 = seg_code[d2]; delay_ms(2);
  54   1        select_digit(5); P0 = seg_code[d4]; delay_ms(2);
  55   1        select_digit(6); P0 = seg_code[d3]; delay_ms(2);
C51 COMPILER V9.60.7.0   MAIN                                                              12/03/2025 20:23:49 PAGE 2   

  56   1        
  57   1      }
  58          
  59          void main() {
  60   1          unsigned char hum = 0;
  61   1          unsigned char temp = 0;
  62   1          unsigned char i, j;
  63   1          unsigned char measured_data[5];
  64   1      
  65   1          DHT22_VCC = 1;   // Power on
  66   1          DHT22_GND = 0;   // Ground
  67   1          DHT22_DATA = 1;  // Idle state
  68   1      
  69   1          while (1) {
  70   2              // MCU initiates communication
  71   2              DHT22_DATA = 0;
  72   2              delay_ms(18);        // Pull low for at least 18ms
  73   2              DHT22_DATA = 1;
  74   2              delay_us(30);        // Wait 20–40us
  75   2      
  76   2              // Wait for DHT response: LOW for ~80us, then HIGH for ~80us
  77   2              while (DHT22_DATA);  // Wait for DHT to pull LOW
  78   2              while (!DHT22_DATA); // Wait for DHT to pull HIGH
  79   2              while (DHT22_DATA);  // Wait for DHT to pull LOW again (start of data transmission)
  80   2      
  81   2              // Read 5 bytes (40 bits)
  82   2              for (j = 0; j < 5; j++) {
  83   3                  measured_data[j] = 0;
  84   3                  for (i = 0; i < 8; i++) {
  85   4                      while (!DHT22_DATA); // Wait for LOW-to-HIGH transition
  86   4                      delay_us(30);        // Sample at ~30us
  87   4      
  88   4                      measured_data[j] <<= 1;
  89   4                      if (DHT22_DATA) {
  90   5                          measured_data[j] |= 1; // HIGH > 30us means bit '1'
  91   5                      }
  92   4      
  93   4                      while (DHT22_DATA); // Wait for end of HIGH pulse
  94   4                  }
  95   3              }
  96   2      
  97   2              // Verify checksum
  98   2              if (measured_data[4] == (measured_data[0] + measured_data[1] +
  99   2                                       measured_data[2] + measured_data[3])) {
 100   3                  hum  = measured_data[0]; // Integer part of humidity
 101   3                  temp = measured_data[2]; // Integer part of temperature
 102   3              } else {
 103   3                  hum  = 0;
 104   3                  temp = 0;
 105   3              }
 106   2      
 107   2              // Display on 7-segment
 108   2              display(temp / 10, temp % 10, hum / 10, hum % 10);
 109   2          }
 110   1      }
 111          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    378    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   MAIN                                                              12/03/2025 20:23:49 PAGE 3   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
